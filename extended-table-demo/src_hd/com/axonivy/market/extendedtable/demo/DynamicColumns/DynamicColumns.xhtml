<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
<h:body>
	<ui:composition template="/layouts/frame-10-full-width.xhtml">
		<ui:define name="title">Extended Table Showcase</ui:define>
		<ui:define name="content">

			<h2>Dynamic Columns</h2>
			<p><b>NOTE</b>: Column id should match with entity's field name to make the table restoration works</p>
			<h:form id="dynamicColumnsForm">
				<p:messages />
				<ic:com.axonivy.market.extendedtable.ExtendedTable
					tableId="dynamicColumnsTable" widgetVar="dynamicColumnsTable"
					id="extendedTable" value="#{data.bean.items}" paginator="true"
					rows="10" scrollable="true" scrollWidth="100%"
					filteredValue="#{data.bean.filteredItems}"
					columnsRenderCallback="#{data.bean.columnsRenderCallback}">

					<f:facet name="header">
						<div class="p-d-flex p-jc-between p-ai-center" style="width: 100%">
							<span>Columns</span>
							<div
								style="display: inline-flex; gap: 10px; align-items: center;">
								<p:selectCheckboxMenu id="columnSelector"
									value="#{data.bean.selectedColumnProperties}"
									label="Select Columns" filter="true" filterMatchMode="contains"
									panelStyle="width:250px" scrollHeight="400">
									<f:selectItems value="#{data.bean.allColumnOptions}" var="opt"
										itemLabel="#{opt.label}" itemValue="#{opt.value}" />
								</p:selectCheckboxMenu>
								<p:commandButton value="Apply" icon="pi pi-check"
									action="#{data.bean.onColumnSelectionChange}"
									update=":dynamicColumnsForm:extendedTable:dynamicColumnsTable"
									styleClass="ui-button-success" />
							</div>
						</div>
					</f:facet>
					<!-- remote command to send visible columns CSV to backing bean -->
					<p:remoteCommand name="updateVisibleColumns"
						action="#{data.bean.updateVisibleColumns}" />

					<c:forEach items="#{data.bean.dynamicColumns}" var="col"
						varStatus="loopVar">
						<c:choose>
							<!-- Name column -->
							<c:when
								test="#{col.property eq 'name' and data.bean.isColumnVisible(col.property)}">
								<p:column id="name" headerText="Name" filterBy="#{item.name}"
									sortBy="#{item.name}" filterMatchMode="contains"
									style="width:200px">
									<f:facet name="filter">
										<p:inputText id="nameFilter" styleClass="custom-filter"
											onchange="filterTable()" placeholder="Search..." />
									</f:facet>
									<h:outputText value="#{item.name}" />
								</p:column>
							</c:when>

							<!-- Company column -->
							<c:when
								test="#{col.property eq 'company' and data.bean.isColumnVisible(col.property)}">
								<p:column id="company" headerText="Company"
									filterBy="#{item.company}" sortBy="#{item.company}"
									filterMatchMode="contains" style="width:200px">
									<f:facet name="filter">
										<p:inputText onchange="filterTable()" placeholder="Search..." />
									</f:facet>
									<h:outputText value="#{item.company}" />
								</p:column>
							</c:when>

							<!-- Country column -->
							<c:when
								test="#{col.property eq 'country' and data.bean.isColumnVisible(col.property)}">
								<p:column id="country" headerText="Country"
									filterBy="#{item.country.name}" sortBy="#{item.country.name}"
									filterMatchMode="exact" style="width:180px">
									<f:facet name="filter">
										<p:selectOneMenu onchange="filterTable()" filter="true"
											style="width:100%; box-sizing: border-box;">
											<f:selectItem itemLabel="All" itemValue="#{null}"
												noSelectionOption="true" />
											<f:selectItems value="#{data.bean.countries}" var="country"
												itemLabel="#{country.name}" itemValue="#{country.name}" />
										</p:selectOneMenu>
									</f:facet>
									<span class="flag flag-#{item.country.code}"
										style="width: 30px; height: 20px" />
									<h:outputText
										style="vertical-align: middle; margin-left: .5rem"
										value="#{item.country.name}" />
								</p:column>
							</c:when>

							<!-- DateTime column -->
							<!-- 							<c:when
								test="#{col.property eq 'dateTime' and data.bean.isColumnVisible(col.property)}">
								Date Time
								<p:column headerText="Date Time (Multi Selection)"
									field="dateTime">
									<f:facet name="filter">
										<p:datePicker selectionMode="multiple" pattern="dd.MM.yyyy"
											value="#{data.bean.dateTimeFilters[col.property]}" onchange="filterTable()" />
									</f:facet>
									<h:outputText
										value="#{data.bean.formatDateTime(item.dateTime)}" />
								</p:column>

							</c:when> -->

							<!-- Date column -->
							<c:when
								test="#{col.property eq 'date' and data.bean.isColumnVisible(col.property)}">
								<p:column id="date" headerText="Single Date"
									filterBy="#{item.date}" field="date" filterMatchMode="custom"
									filterFunction="#{data.bean.filterDate}" style="width:180px">
									<f:facet name="filter">
										<p:datePicker selectionMode="single" pattern="dd.MM.yyyy"
											value="#{data.bean.dateFilter}" onchange="filterTable()" />
									</f:facet>
									<h:outputText value="#{data.bean.formatDate(item.date)}" />
								</p:column>
							</c:when>

							Date1 column
<!-- 							<c:when
								test="#{col.property eq 'date1' and data.bean.isColumnVisible(col.property)}">
								<p:column id="date1" headerText="Date 1"
									filterBy="#{item.date1}" sortBy="#{item.date1}"
									filterMatchMode="custom"
									filterFunction="#{data.bean.filterDate}" style="width:180px">
									<f:facet name="filter">
										<p:datePicker value="#{data.bean.dateFilters[col.property]}"
											selectionMode="range" pattern="yyyy-MM-dd"
											onchange="filterTable()" showIcon="true" showButtonBar="true"
											style="width:100%" />
									</f:facet>
									<h:outputText value="#{item.date1}" />
								</p:column>
							</c:when> -->

							<!-- Status column -->
							<c:when
								test="#{col.property eq 'status' and data.bean.isColumnVisible(col.property)}">
								<p:column id="status" headerText="Status"
									filterBy="#{item.status}" sortBy="#{item.status}"
									filterMatchMode="custom"
									filterFunction="#{data.bean.filterEnum}" style="width:180px">
									<f:facet name="filter">
										<p:selectCheckboxMenu value="#{data.bean.selectedStatuses}"
											onchange="filterTable()" multiple="true"
											style="width:100%; box-sizing: border-box;">
											<f:selectItems value="#{data.bean.getEnumOptions('status')}"
												var="opt" itemLabel="#{opt.label}" itemValue="#{opt.value}" />
										</p:selectCheckboxMenu>
									</f:facet>
									<span
										class="customer-badge status-#{item.status.name().toLowerCase()}">
										#{item.status} </span>
								</p:column>
							</c:when>

							<!-- Customer Rank column -->
							<c:when
								test="#{col.property eq 'customerRank' and data.bean.isColumnVisible(col.property)}">
								<p:column id="customerRank" headerText="Customer Rank"
									field="customerRank" filterBy="#{item.customerRank}"
									filterMatchMode="custom"
									filterFunction="#{data.bean.filterNumber}" style="width:150px">
									<f:facet name="filter">
										<p:inputText id="customerRankFilter"
											placeholder="4..6, ..10, 5.., or 5" style="width:120px"
											onchange="filterTable()" />
									</f:facet>
									<h:outputText value="#{item.customerRank}" />
								</p:column>
							</c:when>

							<!-- Income column -->
							<c:when
								test="#{col.property eq 'income' and data.bean.isColumnVisible(col.property)}">
								<p:column id="income" headerText="Income" field="income"
									filterMatchMode="custom"
									filterFunction="#{data.bean.filterNumber}" style="width:180px">
									<f:facet name="filter">
										<p:inputText id="incomeFilter"
											placeholder="e.g: 4.5..6.1, ..10.2, 5.., or 5"
											style="width:120px" onchange="filterTable()" />
									</f:facet>
									<h:outputText value="#{item.income}">
										<f:convertNumber locale="de_DE" minFractionDigits="2"
											maxFractionDigits="2" />
									</h:outputText>
								</p:column>
							</c:when>

							<!-- Email column -->
							<c:when
								test="#{col.property eq 'email' and data.bean.isColumnVisible(col.property)}">
								<p:column id="email" headerText="Email" filterBy="#{item.email}"
									sortBy="#{item.email}" filterMatchMode="contains"
									style="width:250px">
									<f:facet name="filter">
										<p:inputText onchange="filterTable()" placeholder="Search..." />
									</f:facet>
									<h:outputText value="#{item.email}" />
								</p:column>
							</c:when>

							<!-- Phone column -->
							<c:when
								test="#{col.property eq 'phone' and data.bean.isColumnVisible(col.property)}">
								<p:column id="phone" headerText="Phone" filterBy="#{item.phone}"
									sortBy="#{item.phone}" filterMatchMode="contains"
									style="width:180px">
									<f:facet name="filter">
										<p:inputText onchange="filterTable()" placeholder="Search..." />
									</f:facet>
									<h:outputText value="#{item.phone}" />
								</p:column>
							</c:when>

							<!-- Address column -->
							<c:when
								test="#{col.property eq 'address' and data.bean.isColumnVisible(col.property)}">
								<p:column id="address" headerText="Address"
									filterBy="#{item.address}" sortBy="#{item.address}"
									filterMatchMode="contains" style="width:220px">
									<f:facet name="filter">
										<p:inputText onchange="filterTable()" placeholder="Search..." />
									</f:facet>
									<h:outputText value="#{item.address}" />
								</p:column>
							</c:when>

							<!-- City column -->
							<c:when
								test="#{col.property eq 'city' and data.bean.isColumnVisible(col.property)}">
								<p:column id="city" headerText="City" filterBy="#{item.city}"
									sortBy="#{item.city}" filterMatchMode="contains"
									style="width:180px">
									<f:facet name="filter">
										<p:inputText onchange="filterTable()" placeholder="Search..." />
									</f:facet>
									<h:outputText value="#{item.city}" />
								</p:column>
							</c:when>

							<!-- Postal Code column -->
							<c:when
								test="#{col.property eq 'postalCode' and data.bean.isColumnVisible(col.property)}">
								<p:column id="postalCode" headerText="Postal Code"
									filterBy="#{item.postalCode}" sortBy="#{item.postalCode}"
									filterMatchMode="contains" style="width:150px">
									<f:facet name="filter">
										<p:inputText onchange="filterTable()" placeholder="Search..." />
									</f:facet>
									<h:outputText value="#{item.postalCode}" />
								</p:column>
							</c:when>

							<!-- Website column -->
							<c:when
								test="#{col.property eq 'website' and data.bean.isColumnVisible(col.property)}">
								<p:column id="website" headerText="Website"
									filterBy="#{item.website}" sortBy="#{item.website}"
									filterMatchMode="contains" style="width:250px">
									<f:facet name="filter">
										<p:inputText onchange="filterTable()" placeholder="Search..." />
									</f:facet>
									<h:outputText value="#{item.website}" />
								</p:column>
							</c:when>

							<!-- Description column -->
							<c:when
								test="#{col.property eq 'description' and data.bean.isColumnVisible(col.property)}">
								<p:column id="description" headerText="Description"
									filterBy="#{item.description}" sortBy="#{item.description}"
									filterMatchMode="contains" style="width:300px">
									<f:facet name="filter">
										<p:inputText onchange="filterTable()" placeholder="Search..." />
									</f:facet>
									<h:outputText value="#{item.description}" />
								</p:column>
							</c:when>

							<!-- Notes column -->
							<c:when
								test="#{col.property eq 'notes' and data.bean.isColumnVisible(col.property)}">
								<p:column id="notes" headerText="Notes" filterBy="#{item.notes}"
									sortBy="#{item.notes}" filterMatchMode="contains"
									style="width:300px">
									<f:facet name="filter">
										<p:inputText onchange="filterTable()" placeholder="Search..." />
									</f:facet>
									<h:outputText value="#{item.notes}" />
								</p:column>
							</c:when>

							<!-- Contact Person column -->
							<c:when
								test="#{col.property eq 'contactPerson' and data.bean.isColumnVisible(col.property)}">
								<p:column id="contactPerson" headerText="Contact Person"
									filterBy="#{item.contactPerson}" sortBy="#{item.contactPerson}"
									filterMatchMode="contains" style="width:200px">
									<f:facet name="filter">
										<p:inputText onchange="filterTable()" placeholder="Search..." />
									</f:facet>
									<h:outputText value="#{item.contactPerson}" />
								</p:column>
							</c:when>

							<!-- Department column -->
							<c:when
								test="#{col.property eq 'department' and data.bean.isColumnVisible(col.property)}">
								<p:column id="department" headerText="Department"
									filterBy="#{item.department}" sortBy="#{item.department}"
									filterMatchMode="contains" style="width:180px">
									<f:facet name="filter">
										<p:inputText onchange="filterTable()" placeholder="Search..." />
									</f:facet>
									<h:outputText value="#{item.department}" />
								</p:column>
							</c:when>

							<!-- Group column -->
							<c:when
								test="#{col.property eq 'group' and data.bean.isColumnVisible(col.property)}">
								<p:column id="group" headerText="Group"
									filterBy="#{item.group.name}" sortBy="#{item.group.name}"
									filterMatchMode="contains" style="width:180px">
									<f:facet name="filter">
										<p:inputText onchange="filterTable()" placeholder="Search..." />
									</f:facet>
									<h:outputText value="#{item.group.name}" />
								</p:column>
							</c:when>

							<!-- Has Representative column -->
							<c:when
								test="#{col.property eq 'hasRepresentative' and data.bean.isColumnVisible(col.property)}">
								<p:column id="hasRepresentative" headerText="Has Representative"
									sortBy="#{item.hasRepresentative}"
									filterBy="#{item.hasRepresentative}" style="width:200px">
									<f:facet name="filter">
										<p:selectOneMenu onchange="filterTable()">
											<f:selectItem itemLabel="All" itemValue="#{null}"
												noSelectionOption="true" />
											<f:selectItem itemLabel="True" itemValue="true" />
											<f:selectItem itemLabel="False" itemValue="false" />
										</p:selectOneMenu>
									</f:facet>
									<h:outputText
										value="#{item.hasRepresentative ? 'True' : 'False'}" />
								</p:column>
							</c:when>

							<c:otherwise>
								<!-- Default fallback for unknown column types -->
							</c:otherwise>
						</c:choose>
					</c:forEach>
				</ic:com.axonivy.market.extendedtable.ExtendedTable>

			</h:form>

			<script>
				function filterTable() {
					PF('dynamicColumnsTable').filter();
				}
			</script>
		</ui:define>
	</ui:composition>
</h:body>

</html>