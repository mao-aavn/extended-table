<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">
<h:body>
	<ui:composition template="/layouts/frame-10-full-width.xhtml">
		<ui:define name="title">Extended Table Showcase</ui:define>
		<ui:define name="content">

			<h:form id="nonePaginationForm" style="margin-top: 100px;">
				<p:messages />
				<ic:com.axonivy.market.extendedtable.ExtendedTable
				tableId="rowExpansionTable" widgetVar="rowExpansionTable"
				id="rowExpansionTableWrapper" value="#{data.bean.items}"
				rowKey="#{item.id}"
					showDeleteButton="true" showResetButton="true" paginator="true"
					sortMode="multiple" filteredValue="#{data.bean.filteredItems}"
					allowUnsorting="true">

					<!-- Toggler column: required to show expand/collapse control -->
					<p:column style="width:3%">
						<p:rowToggler />
					</p:column>

					<!-- Name column -->
					<p:column headerText="Name" filterBy="#{item.name}"
						sortBy="#{item.name}" filterMatchMode="contains">
						<f:facet name="filter">
							<p:inputText id="nameFilter" styleClass="custom-filter"
								onchange="filterTable()" />
						</f:facet>

						<h:outputText value="#{item.name}" />
					</p:column>

					<!-- Date Range with custom filter to avoid RangeFilterConstraint issues -->
					<p:column headerText="Date Range" filterBy="#{item.date}"
						field="date" filterMatchMode="custom"
						filterFunction="#{data.bean.filterDate}">
						<f:facet name="filter">
							<p:datePicker selectionMode="range" pattern="dd.MM.yyyy"
								value="#{data.bean.datesFilter}" onchange="filterTable()" />
						</f:facet>
						<h:outputText value="#{data.bean.formatDate(item.date)}" />
					</p:column>

					<!-- Rank column with single input range syntax -->
					<p:column headerText="Number Rank" field="rank"
						filterBy="#{item.rank}" filterMatchMode="custom"
						filterFunction="#{data.bean.filterNumber}">
						<f:facet name="filter">
							<p:inputText id="rankFilter" placeholder="e.g: 4..6, ..10, 5.., or 5"
								style="width:120px" onchange="filterTable()" />
						</f:facet>
						<h:outputText value="#{item.rank}" />
					</p:column>
					
					<!-- Income column-->
					<p:column headerText="Income" field="income" filterMatchMode="custom"
						filterFunction="#{data.bean.filterNumber}">
						<f:facet name="filter">
							<p:inputText id="incomeFilter"
								placeholder="e.g: 4.5..6.1, ..10.2, 5.., or 5" style="width:120px"
								onchange="filterTable()" />
						</f:facet>
						<h:outputText value="#{item.income}">
							<f:convertNumber locale="de_DE" minFractionDigits="2"
								maxFractionDigits="2" />
						</h:outputText>
					</p:column>

					<!-- Has Representative column -->
					<p:column headerText="Has Representative"
						sortBy="#{item.hasRepresentative}"
						filterBy="#{item.hasRepresentative}">
						<f:facet name="filter">
							<p:selectOneMenu onchange="filterTable()">
								<f:selectItem itemLabel="All" itemValue="#{null}"
									noSelectionOption="true" />
								<f:selectItem itemLabel="True" itemValue="true" />
								<f:selectItem itemLabel="False" itemValue="false" />
							</p:selectOneMenu>
						</f:facet>
						<h:outputText value="#{item.hasRepresentative ? 'True' : 'False'}" />
					</p:column>


					<!-- Country column -->
					<p:column headerText="Country" filterBy="#{item.country.name}"
						sortBy="#{item.country.name}" filterMatchMode="exact">
						<f:facet name="filter">
							<p:selectOneMenu onchange="filterTable()" filter="true"
								style="width:100%; box-sizing: border-box;">
								<f:selectItem itemLabel="All" itemValue="#{null}"
									noSelectionOption="true" />
								<f:selectItems value="#{data.bean.countries}" var="country"
									itemLabel="#{country.name}" itemValue="#{country.name}" />
							</p:selectOneMenu>
						</f:facet>
						<span class="flag flag-#{item.country.code}"
							style="width: 30px; height: 20px" />
						<h:outputText style="vertical-align: middle; margin-left: .5rem"
							value="#{item.country.name}" />
					</p:column>

					<!-- Status column (Multiple selection) with custom filter -->
					<p:column headerText="Status" filterBy="#{item.status}"
						sortBy="#{item.status}" filterMatchMode="custom"
						filterFunction="#{data.bean.filterEnum}">
						<f:facet name="filter">
							<p:selectCheckboxMenu value="#{data.bean.selectedStatuses}"
								onchange="filterTable()" multiple="true"
								style="width:100%; box-sizing: border-box;">
								<f:selectItems value="#{data.bean.customerStatus}" />
							</p:selectCheckboxMenu>
						</f:facet>
						<span
							class="customer-badge status-#{item.status.name().toLowerCase()}">
							#{item.status} </span>
					</p:column>

					<!-- Row expansion: show detailed information when a row is expanded -->
					<p:rowExpansion>
						<h:panelGrid columns="2" style="width:100%">
							<h:outputText value="Name:" />
							<h:outputText value="#{item.name}" />
							<h:outputText value="Company:" />
							<h:outputText value="#{item.company}" />
							<h:outputText value="Country:" />
							<h:outputText value="#{item.country != null ? item.country.name : ''}" />
							<h:outputText value="Date Time:" />
							<h:outputText value="#{data.bean.formatDateTime(item.dateTime)}" />
							<h:outputText value="Date:" />
							<h:outputText value="#{data.bean.formatDate(item.date)}" />
							<h:outputText value="Date (alt):" />
							<h:outputText value="#{data.bean.formatDate(item.date1)}" />
							<h:outputText value="Status:" />
							<h:outputText value="#{item.status}" />
							<h:outputText value="Rank:" />
							<h:outputText value="#{item.rank}" />
							<h:outputText value="Income:" />
							<h:outputText>
								<f:convertNumber locale="de_DE" minFractionDigits="2" maxFractionDigits="2" />
								#{item.income}
							</h:outputText>
							<h:outputText value="Email:" />
							<h:outputText value="#{item.email}" />
							<h:outputText value="Phone:" />
							<h:outputText value="#{item.phone}" />
							<h:outputText value="Address:" />
							<h:outputText value="#{item.address}" />
							<h:outputText value="City:" />
							<h:outputText value="#{item.city}" />
							<h:outputText value="Postal Code:" />
							<h:outputText value="#{item.postalCode}" />
							<h:outputText value="Website:" />
							<h:outputLink value="#{item.website}" target="_blank">#{item.website}</h:outputLink>
							<h:outputText value="Description:" />
							<h:outputText value="#{item.description}" />
							<h:outputText value="Notes:" />
							<h:outputText value="#{item.notes}" />
							<h:outputText value="Contact Person:" />
							<h:outputText value="#{item.contactPerson}" />
							<h:outputText value="Department:" />
							<h:outputText value="#{item.department}" />
							<h:outputText value="Group:" />
							<h:outputText value="#{item.group != null ? item.group.name : ''}" />
							<h:outputText value="Has Representative:" />
							<h:outputText value="#{item.hasRepresentative ? 'True' : 'False'}" />
						</h:panelGrid>
					</p:rowExpansion>
				</ic:com.axonivy.market.extendedtable.ExtendedTable>

				<script>
					function filterTable() {
						PF('rowExpansionTable').filter();
					}
				</script>
			</h:form>


		</ui:define>
	</ui:composition>
</h:body>

</html>